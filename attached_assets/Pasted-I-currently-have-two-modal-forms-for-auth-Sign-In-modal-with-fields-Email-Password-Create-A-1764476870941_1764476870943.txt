I currently have two modal forms for auth:

“Sign In” modal with fields: Email + Password

“Create Account” modal with fields: Name + Email + Password
These are simple HTML/JS components used when the user wants to download free resources or starts the assesment.

I want you to refactor the auth to use Supabase email OTP (no passwords) and to collect additional fields on signup: Name, College/Company, Role.

Here is exactly what I want implemented:

Supabase client

Use env vars for URL and anon key: VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY.

Auth flow as a state machine

Replace the old email+password auth with a 3-step flow inside a single modal:

view = "email": asks only for email.

view = "otp": input for 6-digit OTP.

view = "profile": fields for Name, College/Company, Role (only for new users).

Maintain simple JS state such as:

authView ("email" | "otp" | "profile")

pendingEmail

currentUser

isNewUser

Email screen implementation

UI: title “Sign in or create an account”, subtitle “Use your email to get a login code”, one email input, primary button “Continue”.

On submit, call:

supabase.auth.signInWithOtp({
  email: pendingEmail,
  options: { shouldCreateUser: true }
});


On success, switch to authView = "otp" and re-render the modal.

OTP screen implementation

UI: title “Enter the 6-digit code”, subtitle “We sent a code to {pendingEmail}”, OTP input (6 digits), primary button “Verify”, plus a “Resend code” link.

On submit, call supabase.auth.verifyOtp({ email: pendingEmail, token, type: "email" }).

Save data.user into currentUser.

After successful verification, check if a profile exists:

const { data: profile } = await supabase
  .from("profiles")
  .select("*")
  .eq("id", currentUser.id)
  .maybeSingle();


If profile is null/undefined → set isNewUser = true and authView = "profile".

If profile exists → close the modal and treat this as login success.

Profile screen implementation (signup extra fields)

UI: title “Complete your profile”, subtitle “One last step towards your AI PM journey”.

Fields:

Name (input, required)

College / Company (input optiona)

Role (dropdown with options like “Student”, “Recent graduate”, “Product Manager”, “Product Analyst”,"Developer", "QA")

Primary button: “Continue”.

On submit, call:

supabase.from("profiles").upsert({
  id: currentUser.id,
  full_name: name,
  college_company: collegeCompany,
  role
});


After successful upsert, close the modal and show a small success message or redirect.

UI details

Reuse the existing modal styling (width, padding, close icon, purple CTA button).

Adjust the headings and subtitles to match the new flow:

Email view title: “Sign in or create an account”

OTP view title: “Enter the 6-digit code”

Profile view title: “Complete your profile”

At the bottom of the email view, include small text:
“Already have an account? You’ll sign in automatically.”
“New here? We’ll create your account after you enter the code.”

Remove old password-based logic

Remove all form fields, validation, and JS code related to passwords.

Ensure that any old login / signup handlers now use the new OTP-based flow.

Please modify the existing codebase accordingly, updating both the HTML/JS and any relevant CSS to support the 3-step modal flow. Keep the code clean and well-commented so I can tweak copy and styling later. 
